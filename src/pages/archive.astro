---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const archivedPosts = await getCollection('blog', ({ data }) => data.archived);
const sortedArchived = archivedPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);
};
---

<BaseLayout
  title="Archive - Ravi Chandu"
  description="Archived blog posts and older content from my portfolio."
>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-slate-900 dark:to-slate-800 py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <h1 class="text-4xl sm:text-5xl font-bold mb-4">Archive</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        Older articles and content from previous years. These posts are preserved for reference and historical interest.
      </p>
    </div>
  </section>

  <!-- Archived Posts List -->
  <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    {
      sortedArchived.length > 0 ? (
        <div class="space-y-4">
          {sortedArchived.map((post) => (
            <div class="group border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:border-gray-400 dark:hover:border-gray-600 transition-colors opacity-75">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                  <h3 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-cyan-400 transition-colors mb-2">
                    {post.data.title}
                  </h3>
                  <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-2 mb-3">
                    {post.data.description}
                  </p>
                  <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-500">
                    <time datetime={post.data.pubDate.toISOString()}>
                      {formatDate(post.data.pubDate)}
                    </time>
                    {post.data.category && (
                      <>
                        <span>â€¢</span>
                        <span>{post.data.category}</span>
                      </>
                    )}
                  </div>
                </div>
                <a
                  href={`/blog/${post.slug}`}
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-blue-600 dark:hover:border-cyan-400 hover:text-blue-600 dark:hover:text-cyan-400 transition-colors whitespace-nowrap"
                >
                  Read â†’
                </a>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <p class="text-gray-600 dark:text-gray-400 text-lg mb-4">
            No archived posts at the moment.
          </p>
          <a
            href="/blog"
            class="text-blue-600 dark:text-cyan-400 hover:underline font-semibold"
          >
            View Current Blog â†’
          </a>
        </div>
      )
    }

    <!-- Info Box -->
    <div class="mt-12 p-6 rounded-lg border border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20">
      <h3 class="font-bold text-yellow-900 dark:text-yellow-200 mb-2">ðŸ“š Archive Note</h3>
      <p class="text-sm text-yellow-800 dark:text-yellow-300">
        These posts are from previous years and may contain outdated information. They are preserved for historical reference. For the latest content and insights, please visit the main <a href="/blog" class="underline hover:no-underline font-semibold">blog section</a>.
      </p>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="relative bg-gradient-to-r from-blue-600 to-cyan-500 dark:from-blue-900 dark:to-cyan-800 text-white mt-20 overflow-hidden">
    <div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center">
      <h2 class="text-3xl font-bold mb-4">Looking for Recent Articles?</h2>
      <p class="text-xl text-blue-100 dark:text-blue-200 mb-8">
        Check out the latest blog posts and articles.
      </p>
      <a
        href="/blog"
        class="inline-block px-8 py-4 rounded-lg bg-white text-blue-600 font-semibold hover:bg-gray-100 transition-colors"
      >
        Visit Blog
      </a>
    </div>
  </section>
</BaseLayout>
